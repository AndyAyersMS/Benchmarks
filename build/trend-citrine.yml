# Executes the Proxy benchmarks on citrine

# Agent-less jobs need this pool
pool: server

variables:
  - name: plaintextJobs
    value: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.plaintext.json
  - name: defaultArgs
    value: --server $(server) --client $(client) --runtimeversion 5.0.* --self-contained --warmup 5 --duration 5

# all the jobs are triggered at the same time
# jobs are in parallel
# steps are serial

jobs:
- job: Trends
  steps:
  - task: PublishToAzureServiceBus@1
    displayName: Plaintext
    condition: always()
    inputs:
      azureSubscription: ASP.NET Benchmarks Queue
      waitForCompletion: true
      messageBody: |
        {
          "name": "benchmarksdriver",
          "args": [ "$(plaintextJobs)", "$(defaultArgs)", "-n", "Plaintext" ]
        }
  - task: PublishToAzureServiceBus@1
    displayName: Plaintext non pipelined
    condition: always()
    inputs:
      azureSubscription: ASP.NET Benchmarks Queue
      waitForCompletion: true
      messageBody: |
        {
          "name": "benchmarksdriver",
          "args": [ "$(plaintextJobs)", "$(defaultArgs)", "-n", "PlaintextNonPipelined" ]
        }
