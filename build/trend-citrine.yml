# Executes the Proxy benchmarks on citrine

# Agent-less jobs need this pool
pool: server

variables:
  - name: plaintextJobs
    value: https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.plaintext.json

# all the jobs are triggered at the same time
# jobs are in parallel
# steps are serial

jobs:
- job: Trends
  steps:
  - task: PublishToAzureServiceBus@1
    displayName: Plaintext
    condition: always()
    inputs:
      azureSubscription: ASP.NET Benchmarks Queue
      waitForCompletion: true
      messageBody: |
        {
          "name": "benchmarksdriver",
          "args": [ "--server", "$(server)", "--client", "$(client)", "-j", "$(plaintextJobs)", "-n", "Plaintext", "--runtimeversion", "5.0.*" ]
        }
  - task: PublishToAzureServiceBus@1
    displayName: Plaintext non pipelined
    condition: always()
    inputs:
      azureSubscription: ASP.NET Benchmarks Queue
      waitForCompletion: true
      messageBody: |
        {
          "name": "benchmarksdriver",
          "args": [ "--server", "$(server)", "--client", "$(client)", "-j", "$(plaintextJobs)", "-n", "PlaintextNonPipelined", "--runtimeversion", "5.0.*" ]
        }
