{
  "variables": {
    "header-sets": {
      "none": "",
      "plaintext": "--header Accept:text/plain,text/html;q=0.9,application/xhtml+xml;q=0.9,application/xml;q=0.8,*/*;q=0.7 --header Connection:keep-alive",
      "connection-close": "--header Connection:close"
    },
    "preset-headers": "plaintext"
  },
  "dependencies": [ "application", "load" ],
  "services": {
    "application": {
      "source": {
        "repository": "https://github.com/aspnet/benchmarks.git",
        "branchOrCommit": "master",
        "project": "src/Benchmarks/Benchmarks.csproj"
      },
      "readyStateText": "Application started.", // The text in the console that informs the server it has started
      "variables": {
        "connection-header": "--header Connection:keep-alive"
      }
    },
    "load": {
      "source": {
        "repository": "https://github.com/aspnet/benchmarks.git",
        "branchOrCommit": "master",
        "project": "src/PipeliningClient/PipeliningClient.csproj"
      },
      "isConsoleApp": true,
      "readyStateText": "Starting",
      "sdkVersion": "3.0.100",
      "aspnetcoreversion": "3.0",
      "runtimeversion": "3.0",
      "noArguments": true,
      "waitForExit": true, // Blocking
      "timeout": 60,
      // "span": "1:00:00", // Keeps repeating the jobs for this duration
      "variables": {
        "serverUri": null,
        "path": null,
        "connections": 256,
        "warmup": 5,
        "duration": 5,
        "pipeline": 16
      },
      "arguments": "--url={{serverUri}}{{path}} --connections={{connections}} --warmup={{warmup}} --duration={{duration}} --pipeline={{pipeline}} {{header-sets[preset-headers]}}"
    },
    "database": {
      "source": {
        "repository": "https://github.com/TechEmpower/FrameworkBenchmarks.git",
        "branchOrCommit": "master",
        "dockerfile": "toolset/databases/postgres/postgres.dockerfile",
        "dockerImageName": "postgres",
        "dockerContextDirectory": "toolset/databases/postgres/"
      }
    }
  },
  "profiles": {
    "plaintext": {
      "variables": {
        "path": "/plaintext"
      }
    },
    "plaintextNonPipelined": {
      "variables": {
        "path": "/plaintext",
        "pipeline": 1
      }
    },
    "mvcPlaintext": {
      "variables": {
        "path": "/mvc/plaintext",
        "pipeline": 1
      }
    },
    "connectionClose": {
      "variables": {
        "path": "/plaintext",
        "preset-headers": "connection-close"
      }
    }
  }
}

/*

dotnet run -- 
  --services.application.endpoints http://asp-perf-lin:5001 
  --services.load.endpoints http://asp-perf-load:5001 
  --services.load.endpoints http://asp-perf-db:5001 

  --services.load.source.branch sebros/foo

  --config benchmarks.compose.json
  --config benchmarks.databases.json

  --profile plaintext

  --services.load.variables.warmup 0
  --services.load.variables.serverIp 10.10.10.5

  --dependencies postgres:0 // insert postgres at position 0 of dependencies

  // Some features can be applied on any service

  --services.application.features dotnet-trace
  --services.load.features dotnet-trace:gc-verbose

  --services.application.sdk 5.0.100-alpha1-015721
  --services.load.span 1:00:00


*/
